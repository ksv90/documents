**РАБОЧИЙ ПРОЦЕСС**
**передачи ресурсов**

**Введение.**

Текущий процесс по доставке ресурсов от иллюстраторов и аниматоров в игру показал себя как неэффективный и запутанный. Часто возникала необходимость искать последнюю версию файлов, если над ними работали несколько человек. Появилась необходимость валидации и контроля этапов работы, что пришлось внедрить в имеющийся механизм. И самое важное – процесс требовал много ручной работы по «перетаскиванию» файлов из одной папки в другую. На каждой описанной точке (и между ними) часто возникали разного рода ошибки, которые увеличивали количество итераций, влияли на скорость доставки ресурсов в игру, и в конечном итоге – тормозили процесс выпуска новых игр. Поэтому принято решение пересмотреть и изменить данный рабочий поток.

Ремарка. Изменение привычных устоев – это всегда тяжело. Практика показывает, что невозможно предусмотреть всех нюансов и предвидеть все исходы на этапе планирования. Какие-то вещи придётся изменять по мере внедрения и доработок. Просьба отнестись к этому с пониманием, а если какой-то этап не до конца понятен или неудобен – незамедлительно сообщить об этом. По сути дела, всё, что делается, преследует цель упростить взаимодействие между командой.

**Инструменты.**

Готовые ресурсы больше не будут храниться в SynologyDrive. Теперь для хранения будет использоваться облачный сервис [Amazon S3](https://aws.amazon.com/ru/s3/).

Работа по созданию, изменению и удалению ресурсов будет происходить через систему управления проектами [Jira](https://jira.releaseband.com/secure/Dashboard.jspa) и средства синхронизации файлов [Mountain Duck](https://mountainduck.io/).

Для просмотра готовых ресурсов можно использовать [Peach](https://peach-c25c4.web.app/), инструментарий которого можно доработать в случае необходимости (сообщить, если потребуется что-то).

В играх будет добавлена возможность заменять файлы на локальные и смотреть на результат непосредственно по месту назначения. Это можно сделать с помощью вкладки Resources, на панели разработчика (там, где сейчас включаются читы). Сервис также можно доработать при необходимости.

Общение между командой будет происходить через Teams (тут ничего нового). Предположительно в будущем сюда можно добавить оповещение по завершению задач Jira и обновлению ресурсов на облаке (дальнейшие планы).

**Начало работы.**

Всем пользователям нужно установить Mountain Duck на устройство, на котором происходит разработка. С этим может помочь DevOps (Виталий, обращаться в Teams).

Перед началом разработки новой игры, в Jira создаётся проект с названием игры. После этого на облаке автоматически добавляется одноименная директория, которая будет отображаться у всех пользователей.

Для разработки необходимого ресурса в Jira заводится соответствующая карточка. Карточка – это визуальное представление единицы работы в Jira. Назначенный исполнитель видит карточку на доске в колонке «TO DO», переносит её в статус «IN PROGRESS» и приступает к выполнению. Когда задача выполнена, исполнитель загружает файлы своей работы в Mountain Duck и переносит карточку в статус «REVIEW». После этого исполнителю ничего делать не нужно и можно приступать к следующим задачам.

Карточка, которая находится в статусе «REVIEW», может быть возвращена на доработку исполнителю. Для этого в комментарий к карточке нужно прописать причину возврата на доработку, и карточка должна быть перенесена в статус «IN PROGRESS».

**История карточки.**

Для полного понимания процесса в этом разделе описана история жизни карточки и необходимость каждого статуса, а также люди, которые подключаются к процессу.

Карточка может быть создана только в рамках какого-то проекта. Чаще всего одна игра – один проект. Карточка имеет определенный тип, который показывает, действия какого вида нужно произвести. К примеру Story – для разработки нового функционала, Bug – для исправления ошибок и т.д. У каждой карточки есть поля «Summary» для краткого описания, что нужно сделать и «Description», для подробного описания. В зависимости от типа карточки, у неё могут быть дополнительные обязательные поля, отмеченные красной звёздочкой.

Карточку можно создать вручную или по шаблону. Если какие-то однотипные карточки приходится создавать постоянно из игры в игру, это признак того, что нужно сделать шаблон. По шаблону можно создавать несколько карточек в пару кликов, что экономит время.

После создания карточки она имеет статус «BACKLOG». Когда возникает необходимость выполнить действие, описанное в карточке, Лид назначает исполнителя и добавляет её на доску. Исполнитель видит карточку в колонке «TO DO» и может взять в работу, перенеся её в следующую колонку «IN PROGRESS». После выполнения описанного в карточке действия, карточка переносится в колонку «REVIEW». Лид проверяет выполненное действие и переносит карточку в следующую колонку. В зависимости от типа карточки она может проходить через тестирование и иметь другие статусы.

На любом этапе карточка может быть возвращена на доработку и перемещена на предыдущий статус, вплоть до статуса «BACKLOG». Если возникает необходимость вернуть карточку на статус назад, в неё добавляется комментарий, о причине возврата. В любом случае финальным этапом для карточки является перенос её в статус «DONE». Тогда описанное действие считается выполненным окончательно. Возвращать карточку из статуса «DONE» запрещается (за исключением форс-мажорных обстоятельств или ошибок).

Все перемещения карточки по статусам можно посмотреть в её истории. Поэтому рекомендуется всегда добавлять комментарии при перемещениях карточки назад. Это, во-первых, поможет исполнителю понять, почему его работу вернули на исправление, а во-вторых, оставит в истории информацию о причинах доработок. Это поможет после завершения игры проводить анализ выполненной работы.

После создания карточки её не следует удалить. Если описанное действие неактуально, карточка должна быть перемещена в статус «DONE» с добавлением комментария о причинах, почему не выполнено это действие. Переместить карточку в «DONE» можно из «BACKLOG».

**Структура каталогов в директории игры на облаке.**

![](structure.png)

Каталоги – это папки, которые находятся на верхнем уровне директории игры. На скрине выше, рядом с ними красный текст. Они являются обязательными. Все каталоги доступны только для чтения. Исключением является upload, куда исполнители загружают файлы. Только с каталогом upload можно взаимодействовать! Остальные – системные каталоги. Пока папки и файлы находятся в каталоге upload их можно редактировать, заменять и удалять. Файлы и папки, которые находятся в других каталогах, можно только просматривать.

Каталог review используется для файлов, которые проходят проверку. В момент, когда происходит проверка, файлы не должны изменяться, поэтому для проверки используется отдельный каталог, в котором запрещено редактирование. Все файлы находятся на облаке в единственном экземпляре. Когда возникает необходимость проверки, файлы и папки перемещаются (без копирования) из каталога upload в каталог review.

После прохождения проверки, файлы и папки перемещаются на постоянное место хранения: если это исходник – в каталог source, если ресурс игры – в каталог asset. Куда будет проходить перемещение зависит от типа карточки в Jira. Об этом подробнее ниже.

Не все файлы из каталога review могут попадать на постоянное место хранение. Проверка может выявить, что файлы нуждаются в доработке. Тогда они снова перемещаются в каталог upload для изменения.

Все перемещения файлов и папок происходят автоматически без ручного вмешательства, в зависимости от статуса карточки в Jira. Об этом подробнее ниже.

**Карточка с типом Source.**

Этот тип необходим для создания проектов-исходников. Это могут быть psd-файлы текстур, spine-проекты, проекты по созданию звуков, шрифтов и т.д.

На ряду с вышеописанными полями «Summary» и «Description», у этого типа карточек есть дополнительное обязательное поле – «Folder name» (название папки). Готовые файлы нужно загрузить на облако с помощью Mountain Duck. Так как исходники могут содержать n-ое количество файлов, Jira должна определить какие файлы добавлены в данной карточке. Поэтому файлы нужно объединить и положить в одну папку. В папке с именем из «Folder name» и будут содержаться эти файлы на облаке.

Другим обязательным полем, для карточек этого типа, является поле «Target». Оно указывает, для каких целей создаётся этот исходник. А также будет определять, в каком подкаталоге на облаке будет храниться данная папка. Варианты целей: «illustration» – для макетов и шаблонов, «texture» – для разработки текстур игры, «spine» – для spine-проектов, «common» – для действий, которые не попали в перечисленное. Количество и названия целей может быть изменено по мере необходимости.

Загружать файлы в каталог upload нужно в определённую папку, об этом написано выше. Эта папка появится автоматически, после перемещения карточки в колонку «IN PROGRESS». Папка может иметь имя «animation--symbols» или похожее. Такое название складывается из полей «Folder name» и «Target». Это нужно для предотвращения конфликта имён. Условно, параллельно другой человек может работать над текстурами символов, и его рабочая папка будет «texture--symbols». Если убрать приписку animation и texture, останется только symbols и файлы будут перезаписывать друг друга. Поэтому добавлена приписка. Еще раз: папка с нужным именем появится автоматически, нужно только положить туда готовые файлы.

Если исполнитель загрузит файлы не в нужную папку или переименует её, то карточку не получится переместить на следующую колонку. Jira не сможет найти нужные файлы и посчитает, что они не загружены.

После загрузки файлов на облако, карточку нужно переместить на следующую колонку («REVIEW»), а загруженные файлы в папке, автоматически будут перемещены в каталог review на облаке для проверки. И файлы уже не получится редактировать.

Когда карточка достигла колонки «DONE» рабочая папка на облаке из каталога review перемещаются на постоянное место хранения в каталог source. Если там уже есть папка с таким названием, она перезаписывается.

В случае перемещения карточки из колонки «REVIEW» в колонку «IN PROGRESS», папка из каталога review перемещается в каталог upload и файлы можно будет редактировать. Когда карточка перемещается из колонки «IN PROGRESS» в колонку «TO DO» рабочая папка будет удалена из каталога upload вместе с содержимым. Обратите на это внимание.

Невозможно создать карточку, если уже существует карточка с такой же целью и именем папки, так как в этом нет смысла (если такая карточка существует, значит над файлами этого исходника сейчас кто-то работает). Но если карточка имеет статус «DONE», то может быть создана другая карточка с такой целью и именем папки. Это будет необходимо, когда нужно изменить имеющиеся на облаке файлы. Но в этом случае, исходная папка будет заменена, поэтому на этапе создания карточки будет создано оповещение, которое сообщит, что папка с таким именем и целью уже существует.

**Карточка с типом Asset.**

Данный тип необходим для создания ресурсов игры, используя исходники из облака. После перемещения карточек с типом «Asset» на колонку «DONE», загруженные файлы автоматически попадают в репозиторий игры и программисты смогут их использовать.

У этого типа карточек есть обязательные поля «Folder name» и «Target», которые имеют такие же значения, как и для типа «Source». И сюда добавляется еще одно поле «Group», которое указывает, какой это игровой элемент: фон, барабан, символы и т.д. Название группы необходимо для определения правильного места расположения в репозитории игры.

Процесс перемещения карточек и папок соответствует типу «Source». Отличается только итоговое место хранения файлов – это каталог asset.

**Удаление файлов.**

В процессе разработки, файлы могут не только добавляться, но и удаляться. Механизм удаления файлов также можно организовать через соответствующую задачу. В первую очередь это необходимо, чтобы в репозиторий игры не добавлялись не нужные файлы. Если какой-то файл удалить только в репозитории, то при следующей синхронизации с облаком, он снова добавиться. Поэтому в первую очередь файл нужно удалить на облаке и далее сделать синхронизацию с репозиторием. Тогда программист увидит, что файл удален и сможет внести необходимые изменение в код.
